{"ast":null,"code":"var logger = require(\"js-logger\").get(\"granite:javascript:src:apis:axios\");\n\nimport axios from \"axios\";\nimport { setToLocalStorage, getFromLocalStorage } from \"helpers/storage.js\";\nimport Toastr from \"components/Common/Toastr\";\nvar DEFAULT_ERROR_NOTIFICATION = \"Something went wrong!\";\naxios.defaults.baseURL = \"/\";\n\nvar setAuthHeaders = function setAuthHeaders() {\n  var setLoading = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function () {\n    return null;\n  };\n  axios.defaults.headers = {\n    Accept: \"application/json\",\n    \"Content-Type\": \"application/json\",\n    \"X-CSRF-TOKEN\": document.querySelector('[name=\"csrf-token\"]').getAttribute(\"content\")\n  };\n  var token = getFromLocalStorage(\"authToken\");\n  var email = getFromLocalStorage(\"authEmail\");\n\n  if (token && email) {\n    axios.defaults.headers[\"X-Auth-Email\"] = email;\n    axios.defaults.headers[\"X-Auth-Token\"] = token;\n  }\n\n  setLoading(false);\n};\n\nvar handleSuccessResponse = function handleSuccessResponse(response) {\n  if (response) {\n    response.success = response.status === 200;\n\n    if (response.data.notice) {\n      Toastr.success(response.data.notice);\n    }\n  }\n\n  return response;\n};\n\nvar handleErrorResponse = function handleErrorResponse(axiosErrorObject) {\n  var _axiosErrorObject$res, _axiosErrorObject$res2, _axiosErrorObject$res3, _axiosErrorObject$res4;\n\n  if (((_axiosErrorObject$res = axiosErrorObject.response) === null || _axiosErrorObject$res === void 0 ? void 0 : _axiosErrorObject$res.status) === 401) {\n    setToLocalStorage({\n      authToken: null,\n      email: null,\n      userId: null\n    });\n  }\n\n  Toastr.error(((_axiosErrorObject$res2 = axiosErrorObject.response) === null || _axiosErrorObject$res2 === void 0 ? void 0 : (_axiosErrorObject$res3 = _axiosErrorObject$res2.data) === null || _axiosErrorObject$res3 === void 0 ? void 0 : _axiosErrorObject$res3.error) || DEFAULT_ERROR_NOTIFICATION);\n\n  if (((_axiosErrorObject$res4 = axiosErrorObject.response) === null || _axiosErrorObject$res4 === void 0 ? void 0 : _axiosErrorObject$res4.status) === 423) {\n    window.location.href = \"/\";\n  }\n\n  return Promise.reject(axiosErrorObject);\n};\n\nvar registerIntercepts = function registerIntercepts() {\n  axios.interceptors.response.use(handleSuccessResponse, function (error) {\n    return handleErrorResponse(error);\n  });\n};\n\nexport { setAuthHeaders, registerIntercepts };","map":{"version":3,"sources":["/Users/saigopikar/granite/app/javascript/src/apis/axios.js"],"names":["axios","setToLocalStorage","getFromLocalStorage","Toastr","DEFAULT_ERROR_NOTIFICATION","defaults","baseURL","setAuthHeaders","setLoading","headers","Accept","document","querySelector","getAttribute","token","email","handleSuccessResponse","response","success","status","data","notice","handleErrorResponse","axiosErrorObject","authToken","userId","error","window","location","href","Promise","reject","registerIntercepts","interceptors","use"],"mappings":";;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,iBAAT,EAA4BC,mBAA5B,QAAuD,oBAAvD;AAEA,OAAOC,MAAP,MAAmB,0BAAnB;AAEA,IAAMC,0BAA0B,GAAG,uBAAnC;AAEAJ,KAAK,CAACK,QAAN,CAAeC,OAAf,GAAyB,GAAzB;;AAEA,IAAMC,cAAc,GAAG,SAAjBA,cAAiB,GAA6B;AAAA,MAA5BC,UAA4B,uEAAf;AAAA,WAAM,IAAN;AAAA,GAAe;AAClDR,EAAAA,KAAK,CAACK,QAAN,CAAeI,OAAf,GAAyB;AACvBC,IAAAA,MAAM,EAAE,kBADe;AAEvB,oBAAgB,kBAFO;AAGvB,oBAAgBC,QAAQ,CACrBC,aADa,CACC,qBADD,EAEbC,YAFa,CAEA,SAFA;AAHO,GAAzB;AAOA,MAAMC,KAAK,GAAGZ,mBAAmB,CAAC,WAAD,CAAjC;AACA,MAAMa,KAAK,GAAGb,mBAAmB,CAAC,WAAD,CAAjC;;AACA,MAAIY,KAAK,IAAIC,KAAb,EAAoB;AAClBf,IAAAA,KAAK,CAACK,QAAN,CAAeI,OAAf,CAAuB,cAAvB,IAAyCM,KAAzC;AACAf,IAAAA,KAAK,CAACK,QAAN,CAAeI,OAAf,CAAuB,cAAvB,IAAyCK,KAAzC;AACD;;AACDN,EAAAA,UAAU,CAAC,KAAD,CAAV;AACD,CAfD;;AAiBA,IAAMQ,qBAAqB,GAAG,SAAxBA,qBAAwB,CAAAC,QAAQ,EAAI;AACxC,MAAIA,QAAJ,EAAc;AACZA,IAAAA,QAAQ,CAACC,OAAT,GAAmBD,QAAQ,CAACE,MAAT,KAAoB,GAAvC;;AACA,QAAIF,QAAQ,CAACG,IAAT,CAAcC,MAAlB,EAA0B;AACxBlB,MAAAA,MAAM,CAACe,OAAP,CAAeD,QAAQ,CAACG,IAAT,CAAcC,MAA7B;AACD;AACF;;AACD,SAAOJ,QAAP;AACD,CARD;;AAUA,IAAMK,mBAAmB,GAAG,SAAtBA,mBAAsB,CAAAC,gBAAgB,EAAI;AAAA;;AAC9C,MAAI,0BAAAA,gBAAgB,CAACN,QAAjB,gFAA2BE,MAA3B,MAAsC,GAA1C,EAA+C;AAC7ClB,IAAAA,iBAAiB,CAAC;AAAEuB,MAAAA,SAAS,EAAE,IAAb;AAAmBT,MAAAA,KAAK,EAAE,IAA1B;AAAgCU,MAAAA,MAAM,EAAE;AAAxC,KAAD,CAAjB;AACD;;AACDtB,EAAAA,MAAM,CAACuB,KAAP,CACE,2BAAAH,gBAAgB,CAACN,QAAjB,4GAA2BG,IAA3B,kFAAiCM,KAAjC,KAA0CtB,0BAD5C;;AAGA,MAAI,2BAAAmB,gBAAgB,CAACN,QAAjB,kFAA2BE,MAA3B,MAAsC,GAA1C,EAA+C;AAC7CQ,IAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAuB,GAAvB;AACD;;AACD,SAAOC,OAAO,CAACC,MAAR,CAAeR,gBAAf,CAAP;AACD,CAXD;;AAaA,IAAMS,kBAAkB,GAAG,SAArBA,kBAAqB,GAAM;AAC/BhC,EAAAA,KAAK,CAACiC,YAAN,CAAmBhB,QAAnB,CAA4BiB,GAA5B,CAAgClB,qBAAhC,EAAuD,UAAAU,KAAK;AAAA,WAC1DJ,mBAAmB,CAACI,KAAD,CADuC;AAAA,GAA5D;AAGD,CAJD;;AAMA,SAASnB,cAAT,EAAyByB,kBAAzB","sourcesContent":["import axios from \"axios\";\nimport { setToLocalStorage, getFromLocalStorage } from \"helpers/storage.js\";\n\nimport Toastr from \"components/Common/Toastr\";\n\nconst DEFAULT_ERROR_NOTIFICATION = \"Something went wrong!\";\n\naxios.defaults.baseURL = \"/\";\n\nconst setAuthHeaders = (setLoading = () => null) => {\n  axios.defaults.headers = {\n    Accept: \"application/json\",\n    \"Content-Type\": \"application/json\",\n    \"X-CSRF-TOKEN\": document\n      .querySelector('[name=\"csrf-token\"]')\n      .getAttribute(\"content\")\n  };\n  const token = getFromLocalStorage(\"authToken\");\n  const email = getFromLocalStorage(\"authEmail\");\n  if (token && email) {\n    axios.defaults.headers[\"X-Auth-Email\"] = email;\n    axios.defaults.headers[\"X-Auth-Token\"] = token;\n  }\n  setLoading(false);\n};\n\nconst handleSuccessResponse = response => {\n  if (response) {\n    response.success = response.status === 200;\n    if (response.data.notice) {\n      Toastr.success(response.data.notice);\n    }\n  }\n  return response;\n};\n\nconst handleErrorResponse = axiosErrorObject => {\n  if (axiosErrorObject.response?.status === 401) {\n    setToLocalStorage({ authToken: null, email: null, userId: null });\n  }\n  Toastr.error(\n    axiosErrorObject.response?.data?.error || DEFAULT_ERROR_NOTIFICATION\n  );\n  if (axiosErrorObject.response?.status === 423) {\n    window.location.href = \"/\";\n  }\n  return Promise.reject(axiosErrorObject);\n};\n\nconst registerIntercepts = () => {\n  axios.interceptors.response.use(handleSuccessResponse, error =>\n    handleErrorResponse(error)\n  );\n};\n\nexport { setAuthHeaders, registerIntercepts };\n"]},"metadata":{},"sourceType":"module"}